<h2>Angaben zur Einrichtung ändern oder ergänzen</h2>
<div [formGroup]="einrichtung">
  <mat-form-field class="t30-full-width">
    <input matInput placeholder="Name der Einrichtung" formControlName="name">
  </mat-form-field>
  <mat-form-field class="t30-full-width">
    <input matInput placeholder="ggf. anderer Standort/ Zweigstelle/ Nebengebäude (bei Namensgleicheit zu eine andreren Einrichtung/Standort ausfüllen)" formControlName="address_supplement">
    <mat-hint>
      z.B. wenn es drei Standorte gibt und bei zweien Tempo 30 Sinn macht,
      dann bitte für jeden von diesen einen eigenen Antrag ausfüllen und hier jeweils die Bezeichnung des Standortes angeben
    </mat-hint>
  </mat-form-field>
  <mat-form-field class="t30-full-width">
    <mat-select placeholder="Art der Einrichtung" formControlName="type">
      <mat-option value="1">Kindergaten</mat-option>
      <mat-option value="2">Schule</mat-option>
      <mat-option value="3">Alten- und Pflegeheim / Tagespflege</mat-option>
      <mat-option value="4">Krankenhaus</mat-option>
    </mat-select>
  </mat-form-field>
  <b>Adresse der Einrichtung bzw. Nebenstelle</b>
  <mat-form-field class="t30-full-width">
    <input matInput placeholder="Straße und Hausnummer" autocomplete="false" formControlName="street_house_no">
  </mat-form-field>
  <mat-form-field class="t30-half-width">
    <input matInput placeholder="PLZ" formControlName="zip">
  </mat-form-field>
  <mat-form-field class="t30-half-width">
    <input matInput placeholder="Ort" formControlName="city">
  </mat-form-field>
  <div class="t30-full-width-flex">
    <div class="t30-map-div">
      <yaga-map class="t30-map" zoom="17" [(lat)]="mapLat" [(lng)]="mapLon" (dblclick)="mapDblClick($event)">
        <yaga-tile-layer [(url)]="tileLayerUrl"></yaga-tile-layer>
        <yaga-zoom-control></yaga-zoom-control>
        <yaga-circle *ngIf="isMarkerMoved()" [(lat)]="lat" [(lng)]="lon" radius="5" fillColor="blue" color="blue">
        </yaga-circle>
        <yaga-marker [(lat)]="newLat" [(lng)]="newLon" (moveend)="mapMoveEnd();" draggable="true">
          <yaga-icon iconUrl="assets/marker-icon.png" shadowUrl="assets/marker-shadow.png" [(iconSize)]="marker.iconSize" [(iconAnchor)]="marker.iconAnchor" [(popupAnchor)]="marker.popupAnchor" [(tooltipAnchor)]="marker.tooltipAnchor" [(shadowSize)]="marker.shadowSize"></yaga-icon>
        </yaga-marker>
      </yaga-map>
      <mat-hint>Bitte ggf. Position korrigieren: Marker mit der Maus verschieben oder Doppelkick auf neue Position</mat-hint>
    </div>
    <div class="t30-daneben-div">
      <div *ngIf="isMarkerMoved()">
        Soll die Position wirklich von der Kreisposition auf den Marker geändert werden?
        <br>
        <button mat-raised-button color="primary" (click)="posAenderung()">
          <mat-icon>location_on</mat-icon> Ja
        </button>
        <button mat-raised-button color="basic" (click)="posReset()">
          <mat-icon>undo</mat-icon> Nein
        </button>
      </div>
    </div>
  </div>
  <h2>Angaben zu angrenzenden Straßen mit Haupteingang oder An- und Abreiseverkehr zur Einrichtung</h2>
  <div *ngIf=" getStrassenAbschnitte().length === 0">
    <mat-icon color="warn">warning</mat-icon> Hier fehlen die Straßen mit Qull- und Zielverkehr. Wir suchen freiwillige mit Ortskenntnissen!
  </div>

  <ul formArrayName="streetSections" *ngFor="let item of getStrassenAbschnitte().controls; let i = index;">
    <li [formGroupName]="i">
      <mat-form-field class="t30-half-width">
        <input matInput placeholder="Straße" [matAutocomplete]="auto" autocomplete="false" (ngModelChange)="changeStrassenname($event)" formControlName="street">
      </mat-form-field>
      <mat-autocomplete #auto="matAutocomplete">
        <mat-option *ngIf="isLoading" class="is-loading">
          <mat-spinner diameter="50"></mat-spinner>
        </mat-option>
        <ng-container *ngIf="!isLoading">
          <mat-option *ngFor="let einr of filteredStrassen" [value]="einr">
            <span>{{ einr}}</span>
          </mat-option>
        </ng-container>
      </mat-autocomplete>

<!--     <mat-form-field class="t30-half-width">
       <input matInput placeholder="Straße" formControlName="street">
     </mat-form-field>-->
      <mat-form-field class="t30-hausnummer-width">
        <input matInput placeholder="von Hausnummer" formControlName="house_no_from">
      </mat-form-field>
      <mat-form-field class="t30-hausnummer-width">
        <input matInput placeholder="bis Hausnummer" formControlName="house_no_to">
      </mat-form-field>
      <mat-form-field class="t30-half-width">
        <mat-select placeholder="Forderungsgrund" formControlName="entrance">
          <mat-option value="2">Haupteingang und An- und Abreiseverkehr</mat-option>
          <mat-option value="1">Haupteingang</mat-option>
          <mat-option value="0">An- und Abreiseverkehr</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="t30-half-width">
        <mat-select placeholder="Anzahl der KFZ-Spuren pro Fahrtrichtung" formControlName="multilane">
          <mat-option value="0">Je eine KFZ-Spur je Fahrtrichtung</mat-option>
          <mat-option value="1">Mehr als eine KFZ-Spur je Fahrtrichtung</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="t30-full-width">
        <mat-select placeholder="Tempo-30-Status" formControlName="status">
          <mat-option value="0">Keine Angabe</mat-option>
          <mat-option value="2">Hier ist Tempo 30</mat-option>
          <mat-option value="3">Hier fehlt Tempo 30</mat-option>
          <mat-option value="5">Tempo 30 wurde angeordnet, die Schilder stehen aber noch nicht</mat-option>
          <mat-option value="4">Die Behörde hat abgelehnt, Tempo 30 einzuführen</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="t30-full-width">
        <textarea  matInput formControlName="user_note" placeholder="Warum sollte gerade hier Tempo 30 gelten?"></textarea>
        <mat-hint>
         Uneinsichtige Stelle? Beobachtete Unfälle? Parkende Autos? Viel Radverkehr?...
        </mat-hint>
      </mat-form-field>
      <mat-form-field class="t30-half-width">
        <mat-select placeholder="Busverkehr" formControlName="much_bus_traffic">
          <mat-option value="1">Kein Busverkehr</mat-option>
          <mat-option value="2">weniger als 6 mal pro h</mat-option>
          <mat-option value="3">mind. 6 mal pro h</mat-option>
        </mat-select>
        <mat-hint>
          in mindestens eine Richtung, Werktags zwischen 7 und 8 Uhr
        </mat-hint>
      </mat-form-field>
      <mat-form-field class="t30-half-width">
        <input matInput placeholder="Buslinien" formControlName="bus_lines">
        <mat-hint>
        Welche Buslininien fahren hier? Bitte mit Komma trennen
        </mat-hint>
      </mat-form-field>
      <mat-form-field class="t30-full-width">
        <textarea  matInput formControlName="reason_slower_buses" placeholder="Anmerkung zum Busverkehr"></textarea>
        <mat-hint>
         Kann ein Bus hier wirklich schneller als 30 km/h fahren? Oder ist hier sowieso eine Ampel/Bushaltestelle etc. Bitte unterscheide Hauptverkehrszeit / Nebenzeiten.
         z.B. "Die Busse verlangsamen an der Stelle ohnehin wegen einer Bushaltestelle/der abbiegenden Buslinie ihre Fahrt."
        </mat-hint>
      </mat-form-field>
      <div class="t30-full-width">
        <button mat-raised-button matTooltip="Diesen Straßenabschnitt löschen" (click)="deleteStrassenAbschnitt(i)" type="submit">
          Diesen Straßenabschnitt löschen <mat-icon>delete</mat-icon>
        </button>
      </div>
    </li>
  </ul>
  <button mat-raised-button matTooltip="Neuen Straßenabschnitt hinzufügen" type="submit" (click)="addStrassenAbschnitt()">
    Straßenabschnitt hinzufügen <mat-icon>add</mat-icon>
  </button>
  <div class="t30-checkbox">
  <mat-checkbox formControlName="streetsection_complete">Alle mir bekannten an die Einrichtung angrenzenden Straßenabschnitte sind aufgeführt.</mat-checkbox>
  </div>
  <hr>
  <mat-action-row>
    <button mat-raised-button color="primary" (click)="onSave()">
      <mat-icon>save</mat-icon> Speichern
    </button>
    <button mat-raised-button routerLink="/einrichtung/view/{{id}}">
      <mat-icon>undo</mat-icon> Änderungen verwerfen
    </button>
  </mat-action-row>
</div>
